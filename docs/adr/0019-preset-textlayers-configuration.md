# ADR-0019: Preset — named TextLayers configuration

**Status**: Accepted

## Context

All visualizer content is implemented as `ITextLayerRenderer` layers in TextLayers mode (per [ADR-0014](0014-visualizers-as-layers.md)). The app has only one visualization mode (TextLayers). Cycling through `IVisualizer` modes with the V key was vestigial. Users need a way to save and switch between different TextLayers configurations (9 layers + palette). A Preset is a named snapshot of such a configuration.

## Decision

1. **Preset model**: A Preset has:
   - `Id` (stable GUID) for tracking the active preset
   - `Name` (autogenerated on creation, e.g. "Preset 1", user-editable via R in settings modal)
   - `Config` (deep copy of `TextLayersVisualizerSettings` — 9 layers + PaletteId)

2. **Settings structure**: `VisualizerSettings` has:
   - `Presets` (list of Preset; at least one required)
   - `ActivePresetId` (id of the active preset)
   - `TextLayers` (live editing buffer — always the active preset's config; synced from preset on load/switch, persisted back on save)

3. **V key**: Repurposed from "next visualization mode" to "cycle to next preset". Updates `TextLayers` from the selected preset's Config.

4. **Toolbar**: For TextLayers mode, show "Preset: {name} (V)" instead of "Mode: Layered text (V)".

5. **Preset management in S modal**:
   - Title shows "Preset: {name} (R rename)"
   - R: Rename preset (inline prompt)
   - N: New preset (duplicate of current with autogenerated name)
   - Layer editing applies to the active preset; changes persist automatically.

6. **Migration**: When loading and `Presets` is empty, create one preset from legacy `TextLayers` ("Preset 1") and set as active.

## Consequences

- Users can maintain multiple named layer configurations and switch with V.
- VisualizationMode enum and mode-cycling plumbing were removed (per ADR-0014: no new standalone IVisualizer modes; single TextLayers visualizer only).
- `TextLayersVisualizerSettings` gains `DeepCopy()` and `CopyFrom()` for preset switching.
- Persistence: Presets and ActivePresetId in `VisualizerSettings`; `SaveVisualizerSettings` syncs TextLayers into the active preset before saving.
- **References**: [Preset.cs](../../src/AudioAnalyzer.Domain/VisualizerSettings/Preset.cs), [VisualizerSettings](../../src/AudioAnalyzer.Domain/VisualizerSettings/VisualizerSettings.cs), [FileSettingsRepository](../../src/AudioAnalyzer.Infrastructure/FileSettingsRepository.cs), [ADR-0014](0014-visualizers-as-layers.md).
